version: '1.0'
type: component
data:
    name: omv-services-certbot-form-page
    type: formPage
    config:
        request:
            service: Certbot
            get:
                method: get
            post:
                method: set
        hints:
            - type: warning
              text: _("Let's Encrypt imposes strict rate limits. Use staging mode until your configuration is validated.")
              dismissible: true
              stateId: 4d764c56-6f5b-4da0-b622-6fc37448f8f8
        fields:
            - type: checkbox
              name: enable
              label: _("Enabled")
              value: false
            - type: textInput
              name: composepath
              label: _("Data directory")
              hint: _("Directory where certificates, logs, and configuration files are stored.")
              validators:
                  required: true
              value: '/srv/dev-disk-by-label-data/certbot'
            - type: textInput
              name: email
              label: _("Account email")
              validators:
                  email: true
              value: ''
            - type: textInput
              name: domains
              label: _("Domains")
              hint: _("Comma separated list of domains handled by this certificate.")
              value: ''
            - type: checkbox
              name: staging
              label: _("Use Let's Encrypt staging")
              value: true
            - type: numberInput
              name: httpport
              label: _("HTTP challenge port")
              validators:
                  min: 1
                  max: 65535
                  required: true
              value: 8088
        buttons:
            - template: submit
            - template: cancel
              execute:
                  type: url
                  url: '/services'
            - text: _("Install stack")
              enabledConstraint:
                  operator: truthy
                  arg0:
                      prop: enable
              execute:
                  type: rpc
                  request:
                      service: Certbot
                      method: install
              successNotificationTitle: _("Certbot deployment triggered.")
            - text: _("Restart")
              enabledConstraint:
                  operator: truthy
                  arg0:
                      prop: enable
              execute:
                  type: rpc
                  request:
                      service: Certbot
                      method: restart
              successNotificationTitle: _("Certbot restart started.")
            - text: _("Remove stack")
              execute:
                  type: rpc
                  request:
                      service: Certbot
                      method: remove
              confirm:
                  title: _("Remove Certbot stack")
                  text: _("Containers will be stopped but data remains on disk.")
              successNotificationTitle: _("Certbot stack removal triggered.")
            - text: _("Show status")
              execute:
                  type: rpc
                  request:
                      service: Certbot
                      method: status
              dialog:
                  title: _("Certbot stack status")
                  type: text
                  valueField: stdout
            - text: _("Show logs")
              execute:
                  type: rpc
                  request:
                      service: Certbot
                      method: logs
              dialog:
                  title: _("Recent Certbot logs")
                  type: text
                  valueField: stdout
